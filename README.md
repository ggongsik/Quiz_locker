# Quiz_locker

# Hardened Quiz: λ¦¬λ²„μ‹± μ±λ¦°μ§€ (CTF)

μ΄ ν”„λ΅μ νΈλ” μ •μ  λ° λ™μ  λ¶„μ„μ„ λ°©ν•΄ν•κΈ° μ„ν•΄ μλ„μ μΌλ΅ μ„¤κ³„λ, λ‹¤μ–‘ν• μ•ν‹°-λ¦¬λ²„μ‹±(Anti-Reversing) λ° μ•ν‹°-λ””λ²„κΉ…(Anti-Debugging) κΈ°μ μ΄ μ μ©λ λ¦¬λ²„μ‹± μ±λ¦°μ§€μ…λ‹λ‹¤.

μ΄ μ±λ¦°μ§€μ λ©μ μ€ μΌλ°μ μΈ μ•…μ„±μ½”λ“λ‚ μƒμ© μ†ν”„νΈμ›¨μ–΄ λ³΄νΈ κΈ°μ μ—μ„ μ‚¬μ©λλ” κΈ°λ²•λ“¤μ„ κµ¬ν„ν•κ³ , μ΄λ¥Ό μ°νν•λ” κ²½ν—μ„ μ κ³µν•λ” κ²ƒμ…λ‹λ‹¤.

## π¨ μ¤‘μ”: μ‹¤ν–‰ κ²½κ³ 

μ΄ ν”„λ΅κ·Έλ¨μ€ μ±λ¦°μ§€μ μΌν™μΌλ΅ **"μ•…μ„± ν–‰μ„"λ¥Ό μ‹λ®¬λ μ΄μ…**ν•©λ‹λ‹¤.

1.  **κ΄€λ¦¬μ κ¶ν• ν•„μ”:** ν”„λ΅κ·Έλ¨ μ‹¤ν–‰ μ‹ UACλ¥Ό ν†µν•΄ κ΄€λ¦¬μ κ¶ν•μ„ μ”μ²­ν•©λ‹λ‹¤.
2.  **λ„¤νΈμ›ν¬ μ–΄λ‘ν„° λΉ„ν™μ„±ν™”:** λ¬Έμ μ— λ€ν• κ²€μƒ‰μ„ λ°©ν•΄ν•κΈ° μ„ν•΄, ν”„λ΅κ·Έλ¨μ΄ μ‹μ‘λλ©΄ **λ¨λ“  λ„¤νΈμ›ν¬ μ–΄λ‘ν„°(Wi-Fi, μ΄λ”λ„·)λ¥Ό λΉ„ν™μ„±ν™”**ν•©λ‹λ‹¤.
3.  **μ •μƒ μΆ…λ£ μ‹ λ³µκµ¬:** ν”„λ΅κ·Έλ¨μ„ μ •μƒμ μΌλ΅ μΆ…λ£ν•λ©΄ (ν€΄μ¦λ¥Ό μ™„λ£ν•κ±°λ‚ μ°½μ„ λ‹«μΌλ©΄) λ„¤νΈμ›ν¬ μ–΄λ‘ν„°κ°€ λ‹¤μ‹ ν™μ„±ν™”λ©λ‹λ‹¤.
4.  **νμΌ μ•”νΈν™”:** `sandbox_test_file.txt`λΌλ” νμΌμ„ μƒμ„±ν•κ³  XOR μ•”νΈν™”ν•©λ‹λ‹¤. ν€΄μ¦λ¥Ό 7μ  μ΄μƒμΌλ΅ ν†µκ³Όν•λ©΄ μ΄ νμΌμ΄ λ³µνΈν™”λ©λ‹λ‹¤.

> **[!] κ²½κ³ :** μ΄ ν”„λ΅κ·Έλ¨μ€ κ°€μƒ λ¨Έμ‹ (VM) ν™κ²½μ—μ„ μ‹¤ν–‰ν•λ” κ²ƒμ„ κ°•λ ¥ν κ¶μ¥ν•©λ‹λ‹¤.

## μ±λ¦°μ§€ λ©ν‘

μ΄ ν”„λ΅κ·Έλ¨μ€ μ΄ 10κ°μ ν€΄μ¦λ¥Ό μ μ‹ν•©λ‹λ‹¤. ν€΄μ¦μ μ§λ¬Έκ³Ό μ •λ‹µμ€ λ¨λ‘ μ•”νΈν™”λμ–΄ λ°”μ΄λ„λ¦¬ λ‚΄μ— μ¨κ²¨μ Έ μμµλ‹λ‹¤.

μ±λ¦°μ§€μ λ©ν‘λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

1.  ν”„λ΅κ·Έλ¨μ λ‹¤μ–‘ν• μ•ν‹°-λ¦¬λ²„μ‹± κΈ°λ²•μ„ μ°νν•©λ‹λ‹¤.
2.  μ•”νΈν™”λ 10κ°μ μ§λ¬Έμ„ λ³µνΈν™”ν•μ—¬ μ‹λ³„ν•©λ‹λ‹¤.
3.  μ •λ‹µμ„ μ°Ύμ•„λ‚΄κ±°λ‚, μ •λ‹µ ν™•μΈ λ΅μ§μ„ μ°νν•μ—¬ 7μ  μ΄μƒμ μ μλ¥Ό νλ“ν•©λ‹λ‹¤.
4.  μ μ νλ“ μ‹ μ‹¤ν–‰λλ” `LiberationProtocol`μ„ νΈλ¦¬κ±°ν•μ—¬ `sandbox_test_file.txt`λ¥Ό λ³µνΈν™”ν•©λ‹λ‹¤.

## π› οΈ μ μ©λ μ£Όμ” κΈ°μ  (Features)

μ΄ μ±λ¦°μ§€λ” λ¦¬λ²„μ„(reverser)λ¥Ό λ°©ν•΄ν•κΈ° μ„ν•΄ λ‹¤μκ³Ό κ°™μ€ κΈ°μ λ“¤μ„ κµ¬ν„ν–μµλ‹λ‹¤.

### 1. API Obfuscation (API λ‚λ…ν™”)
* **μ„¤λ…:** `user32.dll`, `kernel32.dll` λ“±μ λΌμ΄λΈλ¬λ¦¬λ¥Ό μ§μ ‘ μ„ν¬νΈν•μ§€ μ•μµλ‹λ‹¤.
* **κµ¬ν„:** ν”„λ΅κ·Έλ¨ μ‹μ‘ μ‹ `GetModuleHandleW`μ™€ `GetProcAddress`λ¥Ό ν†µν•΄ ν•„μ”ν• λ¨λ“  Windows API ν•¨μμ μ£Όμ†λ¥Ό λ°νƒ€μ„μ— λ™μ μΌλ΅ λ΅λ“ν•©λ‹λ‹¤. μ΄λ” IAT(Import Address Table) κΈ°λ°μ μ •μ  λ¶„μ„μ„ λ¬΄λ ¥ν™”ν•©λ‹λ‹¤. λ¨λ“  ν•¨μ ν¬μΈν„°λ” `Api` κµ¬μ΅°μ²΄μ— μ €μ¥λ©λ‹λ‹¤.

### 2. String Encryption (λ¬Έμμ—΄ μ•”νΈν™”)
* **μ„¤λ…:** ν€΄μ¦ μ§λ¬Έ, μ •λ‹µ ν•΄μ‹, μ°½ μ λ©, λ©”μ‹μ§€ λ°•μ¤ λ‚΄μ© λ“± ν”„λ΅κ·Έλ¨μ—μ„ μ‚¬μ©ν•λ” λ¨λ“  μ£Όμ” λ¬Έμμ—΄μ΄ μ•”νΈν™”λμ–΄ μμµλ‹λ‹¤.
* **κµ¬ν„:** κ°„λ‹¨ν• λ΅¤λ§ XOR μ•”νΈν™”(`DecryptW` ν•¨μ)λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤. `strings` κ°™μ€ λ„κµ¬λ΅ λ°”μ΄λ„λ¦¬λ¥Ό λ¶„μ„ν•΄λ„ μλ―Έ μλ” λ¬Έμμ—΄μ„ μ°Ύμ„ μ μ—†μµλ‹λ‹¤.

### 3. Anti-Tampering (λ¬΄κ²°μ„± κ²€μ‚¬)
* **μ„¤λ…:** ν”„λ΅κ·Έλ¨μ ν•µμ‹¬ λ΅μ§(μ •λ‹µ μ μ¶ ν•¨μ)μ΄ λ©”λ¨λ¦¬ μƒμ—μ„ ν¨μΉ(patch)λλ” κ²ƒμ„ λ°©μ§€ν•©λ‹λ‹¤.
* **κµ¬ν„:** `OnSubmitClicked_Start`λ¶€ν„° `OnSubmitClicked_End`κΉμ§€μ ν•¨μ μ½”λ“ μμ—­μ— λ€ν•΄ `CalculateChecksum` ν•¨μλ΅ κ³¨λ“  μ²΄ν¬μ„¬(`g_golden_checksum`)μ„ κ³„μ‚°ν•©λ‹λ‹¤. μ •λ‹µ μ μ¶ μ‹λ§λ‹¤ μ΄ μμ—­μ μ²΄ν¬μ„¬μ„ λ‹¤μ‹ κ³„μ‚°ν•μ—¬ μ›λ³Έκ³Ό λΉ„κµν•©λ‹λ‹¤.
    * *(μ°Έκ³ : ν„μ¬ μ½”λ“(`main3.c`)μ—μ„λ” λ¦¬λ²„μ„μ νΈμλ¥Ό μ„ν•΄ `FIX:` μ£Όμ„κ³Ό ν•¨κ» μ΄ κΈ°λ¥μ΄ λΉ„ν™μ„±ν™”λμ–΄ μμµλ‹λ‹¤.)*

### 4. Anti-Debugging (λ””λ²„κΉ… νƒμ§€)
* **μ„¤λ…:** λ””λ²„κ±°κ°€ ν”„λ΅μ„Έμ¤μ— λ¶™μ–΄μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
* **κµ¬ν„:** `IsDebuggerPresent()` APIλ¥Ό μ£ΌκΈ°μ μΌλ΅ νΈμ¶ν•μ—¬ λ””λ²„κ±°λ¥Ό νƒμ§€ν•©λ‹λ‹¤. (PEBμ `BeingDebugged` ν”λκ·Έλ¥Ό μ§μ ‘ κ²€μ‚¬ν•λ” λ°©μ‹λ„ κ³ λ ¤λμ—μΌλ©°, μ΄λ¥Ό μ„ν•΄ PEB κµ¬μ΅°μ²΄κ°€ μλ™μΌλ΅ μ •μλμ–΄ μμµλ‹λ‹¤.)
    * *(μ°Έκ³ : ν„μ¬ μ½”λ“μ—μ„λ” μ΄ κΈ°λ¥ μ—­μ‹ λΉ„ν™μ„±ν™”λμ–΄ μμµλ‹λ‹¤.)*

### 5. Answer Hashing (μ •λ‹µ ν•΄μ‹)
* **μ„¤λ…:** μ‚¬μ©μμ μ •λ‹µμ„ μ›λ³Έκ³Ό μ§μ ‘ λΉ„κµν•μ§€ μ•κ³ , ν•΄μ‹ κ°’κ³Ό λΉ„κµν•©λ‹λ‹¤.
* **κµ¬ν„:** (μ‚¬μ©μ μ…λ ¥ + "a1eph_nu11_is_running_n0w" μ†”νΈ) κ°’μ„ **SHA256**μΌλ΅ ν•΄μ‹ν•μ—¬ `QUIZ_DATABASE`μ— μ €μ¥λ μ •λ‹µ ν•΄μ‹μ™€ λΉ„κµν•©λ‹λ‹¤.

---

## β™οΈ λΉλ“ λ° μ‹¤ν–‰

### μ”κµ¬ μ‚¬ν•­
* Windows ν™κ²½
* MinGW (GCC)

### μΆ…μ†μ„±
* `sha256.c`
* `sha256.h`

### λΉλ“ λ…λ Ήμ–΄
ν—¤λ” νμΌμ— λ…μ‹λ λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ—¬ λΉλ“ν•  μ μμµλ‹λ‹¤.

```bash
gcc -DUNICODE -D_UNICODE main3.c sha256.c -o challenge.exe -lgdi32 -lshell32 -s -O2 -mwindows
```

## π’΅μλ„λ λ¶„μ„ λ° μ°ν κ²½λ΅ (HINTS)
μ΄ μ±λ¦°μ§€λ” λ‹¤μ–‘ν• λ°©λ²•μΌλ΅ ν’€ μ μμµλ‹λ‹¤.

μ •μ  λ¶„μ„:

DecryptW ν•¨μμ™€ XOR_KEY ("ReversingChallengeIsFun")λ¥Ό μ‹λ³„ν•©λ‹λ‹¤.

IDA Pro, Ghidra λ“±μ λ„κµ¬μ™€ μ¤ν¬λ¦½νΈ(μ: IDAPython)λ¥Ό μ‚¬μ©ν•μ—¬ ENC_λ΅ μ‹μ‘ν•λ” λ¨λ“  μ•”νΈν™”λ λ¬Έμμ—΄μ„ λ³µνΈν™”ν•©λ‹λ‹¤.

λ³µνΈν™”λ μ§λ¬Έμ„ λ³΄κ³ , QUIZ_DATABASEμ— μλ” SHA256 ν•΄μ‹λ¥Ό λ μΈλ³΄μ° ν…μ΄λΈ”μ΄λ‚ μ¨λΌμΈ ν¬λμ»¤λ΅ μ—­μ¶”μ ν•μ—¬ μ •λ‹µμ„ μ°Ύμµλ‹λ‹¤.

λ™μ  λ¶„μ„ (λ””λ²„κΉ…):

AntiDebugCheckλ¥Ό NOP (No-Operation) μ²λ¦¬ν•κ±°λ‚ μ°νν•©λ‹λ‹¤.

DisplayCurrentQuestion ν•¨μ λ‚΄λ¶€μ Api.SetWindowTextW νΈμ¶ μ§ν›„μ— λΈλ μ΄ν¬ν¬μΈνΈλ¥Ό μ„¤μ •ν•μ—¬ λ©”λ¨λ¦¬μ— λ³µνΈν™”λ μ§λ¬Έ λ¬Έμμ—΄μ„ ν™•μΈν•©λ‹λ‹¤.

OnSubmitClicked ν•¨μ λ‚΄λ¶€μ strcmp νΈμ¶ μ§μ „μ— λΈλ μ΄ν¬ν¬μΈνΈλ¥Ό μ„¤μ •ν•μ—¬, μ‚¬μ©μκ°€ μ…λ ¥ν• κ°’μ ν•΄μ‹μ™€ μ •λ‹µ ν•΄μ‹λ¥Ό λ¨λ‘ λ¤ν”„ν•©λ‹λ‹¤.

ν¨μΉ (Patching):

AntiTamperCheckκ°€ λΉ„ν™μ„±ν™”λ κ²ƒμ„ ν™•μΈν•©λ‹λ‹¤. (λ§μ•½ ν™μ„±ν™”λμ–΄ μλ‹¤λ©΄, μ΄ μ²΄ν¬ λ΅μ§ μμ²΄λ¥Ό λ¨Όμ € λ¬΄λ ¥ν™”ν•΄μ•Ό ν•©λ‹λ‹¤.)

OnSubmitClicked ν•¨μ λ‚΄λ¶€μ strcmpμ λ°ν™ κ°’μ„ μ΅°μ‘ν•κ±°λ‚, g_score++λ΅ μ΄μ–΄μ§€λ” λ¶„κΈ°λ¬Έ(μ: je -> jmp)μ„ κ°•μ λ΅ λ³€κ²½ν•μ—¬ ν•­μƒ μ •λ‹µμΌλ΅ μ²λ¦¬λλ„λ΅ λ°”μ΄λ„λ¦¬λ¥Ό ν¨μΉν•©λ‹λ‹¤.
